# Ζήτημα 3: Μοντελοποίηση με Docker Compose

## Εισαγωγή

Σε αυτό το ζήτημα, μοντελοποιήσαμε το backend της εφαρμογής σε YAML μορφοποίηση για αυτοματοποιημένη διάταξη μέσω Docker Compose. Το αρχείο `docker-compose.yml` περιγράφει δύο υπηρεσίες: τη RESTful εφαρμογή μας και τη βάση δεδομένων PostgreSQL.

## Προαπαιτούμενα

- Docker
- Docker Compose

## Περιεχόμενα του docker-compose.yml

### Υπηρεσίες

1. `app` (RESTful υπηρεσία):
   - Χτίζεται από το τοπικό Dockerfile
   - Εικόνα: `restful-service:latest`
   - Εκθέτει τη θύρα 8080
   - Περιβαλλοντικές μεταβλητές για σύνδεση με τη βάση δεδομένων
   - Εξαρτάται από την υπηρεσία `postgres`
   - Συνδέεται στο δίκτυο `myapp-network`
   - Πολιτική επανεκκίνησης: `unless-stopped`
   - Έλεγχος υγείας κάθε 30 δευτερόλεπτα
   - Περιορισμοί πόρων: 0.5 CPUs, 512MB μνήμη

2. `postgres` (Βάση δεδομένων):
   - Χρησιμοποιεί την εικόνα `postgres:13`
   - Περιβαλλοντικές μεταβλητές για αρχικοποίηση της βάσης
   - Όγκοι για μόνιμη αποθήκευση δεδομένων και αρχικοποίηση
   - Συνδέεται στο δίκτυο `myapp-network`
   - Πολιτική επανεκκίνησης: `unless-stopped`
   - Έλεγχος υγείας κάθε 10 δευτερόλεπτα

### Δίκτυα

- `myapp-network`: Τύπου bridge για την επικοινωνία μεταξύ των υπηρεσιών

### Όγκοι

- `pgdata`: Για τη μόνιμη αποθήκευση των δεδομένων της PostgreSQL

## Χρήση

1. Εκκίνηση των υπηρεσιών:
   ```
   docker-compose up -d
   ```

2. Παρακολούθηση των logs:
   ```
   docker-compose logs -f
   ```

3. Τερματισμός των υπηρεσιών:
   ```
   docker-compose down
   ```

## Λεπτομέρειες Υλοποίησης

### Εξαρτήσεις
Η υπηρεσία `app` εξαρτάται από την `postgres` και θα ξεκινήσει μόνο όταν η `postgres` είναι υγιής.

### Έλεγχοι Υγείας
- Για την `app`: Ελέγχει το endpoint `/health` κάθε 30 δευτερόλεπτα
- Για την `postgres`: Χρησιμοποιεί το `/pg_isready` κάθε 10 δευτερόλεπτα

### Περιορισμοί Πόρων
Έχουμε θέσει όρια στους πόρους που μπορεί να χρησιμοποιήσει η υπηρεσία `app` για να αποφύγουμε υπερβολική χρήση πόρων.

### Μόνιμη Αποθήκευση
Χρησιμοποιούμε έναν Docker volume (`pgdata`) για να διασφαλίσουμε ότι τα δεδομένα της βάσης διατηρούνται ακόμα και όταν το container τερματίζεται.

### Αρχικοποίηση Βάσης Δεδομένων
Το αρχείο `init.sql` χρησιμοποιείται για την αρχικοποίηση της βάσης δεδομένων κατά την πρώτη εκκίνηση.

## Αντιμετώπιση Προβλημάτων

1. Αν η υπηρεσία `app` αποτυγχάνει να συνδεθεί στη βάση δεδομένων:
   - Ελέγξτε τα logs της `postgres` για τυχόν σφάλματα εκκίνησης
   - Βεβαιωθείτε ότι οι περιβαλλοντικές μεταβλητές είναι σωστά ρυθμισμένες


[Προηγούμενο: Ζήτημα 2 - Δοχειοποίηση με Docker](zitima2-scripts/README.md) | [Επόμενο: Ζήτημα 4 - Μοντελοποίηση σε Kubernetes](yaml/README.md)