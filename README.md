## Περιεχόμενα

- [Προαπαιτούμενα](#προαπαιτούμενα)
- [Δομή Έργου](#δομή-έργου)
- [Εγκατάσταση](#εγκατάσταση)
- [Χρήση](#χρήση)
- [Διαμόρφωση Docker Compose](#διαμόρφωση-docker-compose)
  - [Υπηρεσίες](#υπηρεσίες)
  - [Δίκτυα](#δίκτυα)
  - [Όγκοι](#όγκοι)
  - [Μεταβλητές Περιβάλλοντος](#μεταβλητές-περιβάλλοντος)
- [Διαχείριση Υπηρεσιών](#διαχείριση-υπηρεσιών)
- [Κλιμάκωση](#κλιμάκωση)
- [Παρακολούθηση](#παρακολούθηση)
- [Αντιμετώπιση Προβλημάτων](#αντιμετώπιση-προβλημάτων)
## Προαπαιτούμενα

- Docker (έκδοση 20.10.0 ή νεότερη)
- Docker Compose (έκδοση 1.29.0 ή νεότερη)
- Git

## Δομή Έργου

```
icsd-cloud-2024/
├── app/
│   └── ... (κώδικας εφαρμογής από το Ζήτημα 1)
├── migrations/
│   └── init.sql
├── docker-compose.yml
├── Dockerfile
├── .env
└── README.md
```

## Εγκατάσταση

1. Κλωνοποιήστε το αποθετήριο:
   ```
   git clone <URL_του_αποθετηρίου>
   cd icsd-cloud-2024
   ```

2. Μεταβείτε στο branch του Ζητήματος 3:
   ```
   git checkout zitima-3
   ```

3. Βεβαιωθείτε ότι το Docker και το Docker Compose είναι εγκατεστημένα και εκτελούνται στο σύστημά σας.

4. Δημιουργήστε ένα αρχείο `.env` στον ριζικό φάκελο του έργου και προσθέστε τις απαραίτητες μεταβλητές περιβάλλοντος (δείτε την ενότητα [Μεταβλητές Περιβάλλοντος](#μεταβλητές-περιβάλλοντος)).

## Χρήση

Για να εκκινήσετε το backend χρησιμοποιώντας Docker Compose:

```
docker-compose up -d
```

Για να σταματήσετε και να αφαιρέσετε τα containers:

```
docker-compose down
```

Για να δείτε τα logs των υπηρεσιών:

```
docker-compose logs
```

Για να ανανεώσετε τις υπηρεσίες μετά από αλλαγές:

```
docker-compose up -d --build
```

## Διαμόρφωση Docker Compose

### Υπηρεσίες

Το `docker-compose.yml` ορίζει δύο υπηρεσίες:

1. `app`: Η RESTful υπηρεσία
   - Χτίζεται από το τοπικό Dockerfile
   - Εκθέτει τη θύρα 8080
   - Έχει εξάρτηση από την υπηρεσία `postgres`
   - Περιλαμβάνει ρυθμίσεις υγείας και περιορισμούς πόρων

2. `postgres`: Η βάση δεδομένων PostgreSQL
   - Χρησιμοποιεί την επίσημη εικόνα PostgreSQL 13
   - Διατηρεί τα δεδομένα σε έναν όγκο Docker
   - Περιλαμβάνει ρυθμίσεις υγείας

### Δίκτυα

Ορίζεται ένα προσαρμοσμένο δίκτυο `myapp-network` τύπου bridge για την επικοινωνία μεταξύ των υπηρεσιών.

### Όγκοι

Ορίζεται ένας όγκος `pgdata` για την μόνιμη αποθήκευση των δεδομένων της PostgreSQL.

### Μεταβλητές Περιβάλλοντος

Οι μεταβλητές περιβάλλοντος ορίζονται στο αρχείο `.env` και χρησιμοποιούνται στο `docker-compose.yml`. Περιλαμβάνουν:

- `DB_USER`: Όνομα χρήστη για τη βάση δεδομένων
- `DB_PASSWORD`: Κωδικός πρόσβασης για τη βάση δεδομένων
- `DB_NAME`: Όνομα της βάσης δεδομένων
- `SERVER_PORT`: Θύρα στην οποία θα ακούει η εφαρμογή

Παράδειγμα περιεχομένου του `.env`:

```
DB_USER=meter
DB_PASSWORD=meter
DB_NAME=userdb
SERVER_PORT=8080
```

## Διαχείριση Υπηρεσιών

- Οι υπηρεσίες έχουν ρυθμισμένους ελέγχους υγείας (healthchecks) για αυτόματη ανίχνευση προβλημάτων.
- Η πολιτική επανεκκίνησης `unless-stopped` εξασφαλίζει ότι οι υπηρεσίες θα επανεκκινηθούν αυτόματα σε περίπτωση αποτυχίας.
- Οι περιορισμοί πόρων στην υπηρεσία `app` βοηθούν στη διαχείριση της χρήσης του συστήματος.

